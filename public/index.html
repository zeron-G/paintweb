<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana - AI Painter</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-900 text-zinc-100 min-h-screen p-6">
    <div class="max-w-xl mx-auto space-y-6">
        <header class="text-center py-8">
            <h1 class="text-4xl font-black text-yellow-400">ğŸŒ NANO BANANA</h1>
            <p class="text-zinc-400 mt-2">åŸºäº Google Imagen çš„ç§æœ‰ç”»å›¾å·¥å…·</p>
        </header>

        <div class="bg-zinc-800 p-6 rounded-2xl border border-zinc-700 shadow-2xl">
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2">Google API Key</label>
                    <input type="password" id="apiKey" class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 outline-none focus:border-yellow-400 transition" placeholder="åœ¨æ­¤ç²˜è´´ä½ çš„å¯†é’¥...">
                </div>

                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2">æè¿°å†…å®¹</label>
                    <textarea id="prompt" class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 outline-none focus:border-yellow-400 transition h-32" placeholder="æè¿°ä¸€ä¸ªæœªæ¥ä¸»ä¹‰çš„éœ“è™¹é¦™è•‰..."></textarea>
                </div>

                <button onclick="draw()" id="btn" class="w-full bg-yellow-400 hover:bg-yellow-500 text-zinc-900 font-black py-4 rounded-xl transition-all transform active:scale-95">
                    ç«‹å³ç”Ÿæˆå›¾ç‰‡
                </button>
            </div>
        </div>

        <div id="display" class="relative group">
            </div>
    </div>

    <script>
        // åˆå§‹åŒ–ï¼šä»æœ¬åœ°è¯»å– Key
        document.getElementById('apiKey').value = localStorage.getItem('gemini_key') || '';

        async function draw() {
            const apiKey = document.getElementById('apiKey').value;
            const prompt = document.getElementById('prompt').value;
            const btn = document.getElementById('btn');
            const display = document.getElementById('display');

            if (!apiKey || !prompt) return alert('è¯·æ£€æŸ¥ Key å’Œæè¿°');

            // ä¿å­˜ Key åˆ°æœ¬åœ°ä¾›ä¸‹æ¬¡ä½¿ç”¨
            localStorage.setItem('gemini_key', apiKey);

            btn.disabled = true;
            btn.innerText = 'æ­£åœ¨æ¥å…¥ Google AI...';
            display.innerHTML = '<div class="h-64 flex items-center justify-center text-zinc-500 border-2 border-dashed border-zinc-700 rounded-2xl italic">AI æ­£åœ¨æ ¹æ®æ‚¨çš„æŒ‡ä»¤æ„å›¾...</div>';

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, prompt })
                });
                const data = await res.json();

                if (data.image) {
                    display.innerHTML = `<img src="data:image/png;base64,${data.image}" class="w-full rounded-2xl shadow-2xl border-4 border-zinc-800">`;
                } else {
                    display.innerHTML = `<div class="p-4 bg-red-900/20 border border-red-500/50 text-red-400 rounded-lg text-sm">${data.error}</div>`;
                }
            } catch (e) {
                display.innerHTML = '<div class="text-red-500 text-center">ç½‘ç»œè¿æ¥é”™è¯¯</div>';
            } finally {
                btn.disabled = false;
                btn.innerText = 'ç«‹å³ç”Ÿæˆå›¾ç‰‡';
            }
        }
    </script>
</body>
</html>
