<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana - äº§å“è¯•ç©¿ AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen p-6 font-sans">
    <div class="max-w-2xl mx-auto space-y-8">
        <header class="text-center pt-10 pb-6">
            <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">NANO BANANA</h1>
            <p class="text-zinc-500 mt-3 text-lg">åŸºäº Gemini Image çš„äº§å“å›¾ç”Ÿå›¾å·¥å…·</p>
        </header>

        <div class="bg-zinc-900/50 backdrop-blur-sm p-8 rounded-3xl border border-zinc-800 shadow-2xl space-y-6">
            
            <div>
                <label class="block text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2">Google API Key</label>
                <input type="password" id="apiKey" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-4 outline-none focus:border-yellow-500 transition text-zinc-300" placeholder="ç²˜è´´ä½ çš„ Gemini API Key...">
            </div>

            <div>
                <label class="block text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2">å‚è€ƒäº§å“å›¾</label>
                <div class="relative group cursor-pointer">
                    <input type="file" id="refImage" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 z-20 cursor-pointer" onchange="handleImageUpload()">
                    
                    <div id="uploadBox" class="w-full bg-zinc-950 border-2 border-dashed border-zinc-800 rounded-xl p-6 text-center transition-all group-hover:border-yellow-500/50 group-hover:bg-zinc-900 flex flex-col items-center justify-center min-h-[160px]">
                        <div id="uploadPlaceholder" class="space-y-2">
                            <div class="text-4xl">ğŸ“¸</div>
                            <div class="text-zinc-400 font-medium">ç‚¹å‡»ä¸Šä¼ äº§å“ç…§ç‰‡</div>
                            <div class="text-zinc-600 text-sm">æ”¯æŒ JPG, PNG (å»ºè®®å°äº 4MB)</div>
                        </div>
                        <img id="preview" class="hidden max-h-64 rounded-lg shadow-lg object-contain z-10">
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2">ç”ŸæˆæŒ‡ä»¤</label>
                <textarea id="prompt" class="w-full bg-zinc-950 border border-zinc-800 rounded-xl p-4 outline-none focus:border-yellow-500 transition h-32 resize-none text-zinc-300" placeholder="ä¾‹å¦‚ï¼šä¸€ä½ä¸“ä¸šçš„æ¬§ç¾æ¨¡ç‰¹æ­£åœ¨è¡—å¤´ä½©æˆ´è¿™æ¬¾å¢¨é•œï¼Œé˜³å…‰æ˜åªšï¼Œæ—¶å°šæ‚å¿—é£æ ¼..."></textarea>
            </div>

            <button onclick="generate()" id="btn" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-300 hover:to-orange-400 text-zinc-950 font-black py-4 rounded-xl transition-all transform active:scale-[0.98] shadow-lg shadow-orange-500/20 text-lg">
                å¼€å§‹ç”Ÿæˆ
            </button>
        </div>

        <div id="display" class="empty:hidden rounded-3xl overflow-hidden border border-zinc-800 shadow-2xl bg-black"></div>
    </div>

    <script>
        // åˆå§‹åŒ– Key
        document.getElementById('apiKey').value = localStorage.getItem('gemini_key') || '';
        let base64Image = null;

        function handleImageUpload() {
            const file = document.getElementById('refImage').files[0];
            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('uploadPlaceholder');
            
            if (file) {
                // é™åˆ¶å¤§å°ï¼ŒVercel é™åˆ¶è¯·æ±‚ä½“ 4.5MB
                if (file.size > 4 * 1024 * 1024) {
                    alert("å›¾ç‰‡å¤ªå¤§ï¼Œè¯·ä¸Šä¼ å°äº 4MB çš„å›¾ç‰‡");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    base64Image = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        async function generate() {
            const apiKey = document.getElementById('apiKey').value;
            const prompt = document.getElementById('prompt').value;
            const btn = document.getElementById('btn');
            const display = document.getElementById('display');

            if (!apiKey) return alert('è¯·å¡«å†™ API Key');
            if (!prompt && !base64Image) return alert('è¯·è‡³å°‘å¡«å†™æè¿°æˆ–ä¸Šä¼ å›¾ç‰‡');

            localStorage.setItem('gemini_key', apiKey);
            
            // UI çŠ¶æ€æ›´æ–°
            btn.disabled = true;
            btn.innerText = 'AI æ­£åœ¨æ„æ€ (çº¦10-20ç§’)...';
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            
            display.innerHTML = `
                <div class="h-96 flex flex-col items-center justify-center text-zinc-500 space-y-4 animate-pulse">
                    <div class="w-12 h-12 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div>
                    <p>æ­£åœ¨è¿æ¥ Google Gemini Image æ¨¡å‹...</p>
                </div>
            `;
            display.style.display = 'block';

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        apiKey, 
                        prompt, 
                        image: base64Image 
                    })
                });
                
                const data = await res.json();

                if (data.image) {
                    display.innerHTML = `
                        <div class="relative group">
                            <img src="data:image/png;base64,${data.image}" class="w-full h-auto">
                            <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition flex items-center justify-center gap-4">
                                <a href="data:image/png;base64,${data.image}" download="nano-banana-gen.png" class="bg-white text-black px-6 py-2 rounded-full font-bold hover:bg-yellow-400 transition">ä¸‹è½½å›¾ç‰‡</a>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(data.error || 'æœªçŸ¥é”™è¯¯');
                }
            } catch (e) {
                display.innerHTML = `
                    <div class="p-8 text-center text-red-400 bg-red-950/30">
                        <p class="font-bold text-lg mb-2">ç”Ÿæˆå¤±è´¥</p>
                        <p class="text-sm opacity-80">${e.message}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerText = 'å¼€å§‹ç”Ÿæˆ';
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
    </script>
</body>
</html>
